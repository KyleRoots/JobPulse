<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS API Settings - JobPulse™</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(125deg, #2c3e50 0%, #34495e 25%, #2980b9 50%, #3498db 75%, #5dade2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        .geometric-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.05) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 0%, transparent 50%),
                linear-gradient(45deg, transparent 49%, rgba(255,255,255,0.02) 50%, transparent 51%),
                linear-gradient(-45deg, transparent 49%, rgba(255,255,255,0.02) 50%, transparent 51%);
            background-size: 200px 200px, 300px 300px, 60px 60px, 60px 60px;
            animation: drift 30s linear infinite;
            z-index: -1;
        }
        
        @keyframes drift {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-60px, -60px) rotate(360deg); }
        }
        
        .jobpulse-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .jobpulse-logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 4px 15px rgba(0,0,0,0.7);
            margin-bottom: 0.5rem;
        }
        
        .lyntrix-attribution {
            font-family: 'Kalam', cursive;
            font-size: 0.9rem;
            color: #A8B8C8;
            font-style: italic;
            margin-bottom: 1rem;
        }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #E8F0FF;
            margin-bottom: 0.5rem;
        }
        
        .settings-card {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(15px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .settings-card:hover {
            background: rgba(255,255,255,0.12);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        /* Standard logout button styling with light red background */
        .btn-outline-danger {
            background: rgba(220, 53, 69, 0.8) !important;
            border: 2px solid rgba(220, 53, 69, 0.9) !important;
            color: #ffffff !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
            padding: 0.5rem 1rem !important;
            transition: all 0.3s ease !important;
        }
        
        .btn-outline-danger:hover {
            background: rgba(165, 42, 42, 1) !important;
            border-color: rgba(220, 20, 60, 1) !important;
            color: #ffffff !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.5) !important;
        }
        
        /* Enhanced button styling */
        /* Standard navigation button styling to match other pages */
        .nav-pills .nav-link {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #ffffff;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link:hover {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--bs-primary);
            border-color: var(--bs-primary);
        }
        
        .btn-outline-warning:hover {
            background: rgba(255, 193, 7, 0.25) !important;
            border-color: #ffc107 !important;
            color: #000000 !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4) !important;
        }
        
        .btn-outline-success {
            background: rgba(25, 135, 84, 0.15) !important;
            border: 2px solid rgba(25, 135, 84, 0.8) !important;
            color: #198754 !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
            padding: 0.5rem 1rem !important;
            transition: all 0.3s ease !important;
        }
        
        .btn-outline-success:hover {
            background: rgba(25, 135, 84, 0.25) !important;
            border-color: #198754 !important;
            color: #ffffff !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(25, 135, 84, 0.4) !important;
        }
        
        .jobpulse-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            text-align: center;
            padding: 15px 0;
            font-size: 0.85rem;
            color: #8F9BA8;
            pointer-events: none;
        }
        
        .content-container {
            margin-bottom: 60px;
        }
    
        /* Resume with pulse line effect */
        .jobpulse-logo {
            position: relative;
            display: inline-block;
        }
        
        .jobpulse-logo i {
            position: relative;
            z-index: 2;
        }
        


        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .jobpulse-logo {
                font-size: 2rem !important;
            }
            .page-title {
                font-size: 1.5rem !important;
            }
            .container-fluid {
                padding-left: 15px;
                padding-right: 15px;
            }
            .card-body {
                padding: 1rem;
            }
            .btn {
                font-size: 0.875rem;
                padding: 0.5rem 0.75rem;
            }
            .form-control, .form-select, .form-check-input {
                font-size: 0.875rem;
            }
            .modal-dialog {
                margin: 0.5rem;
            }
        }

        @media (max-width: 576px) {
            .jobpulse-logo {
                font-size: 1.8rem !important;
            }
            .page-title {
                font-size: 1.3rem !important;
            }
            .btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .form-control, .form-select, .form-check-input {
                font-size: 0.8rem;
            }
            .card-header h5 {
                font-size: 1.1rem;
            }
            .row .col-md-6, .row .col-md-4 {
                margin-bottom: 1rem;
            }
            .modal-dialog {
                margin: 0.25rem;
            }
            .table-responsive {
                font-size: 0.8rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="geometric-bg"></div>
    <div class="container py-5 content-container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- JobPulse™ Header -->
                <div class="jobpulse-header">
                    <div class="jobpulse-logo">
                        <i class="fas fa-file-alt me-2" style="animation: spin 4s linear infinite;"></i>
                        JobPulse™
                    </div>
                    <div class="lyntrix-attribution">powered by Lyntrix AI</div>
                    <div class="page-title">ATS API Settings</div>
                    <p class="lead text-muted">
                        Configure your ATS/CRM API credentials
                    </p>
                </div>
                
                <!-- Navigation - Consistent with other pages -->
                <div class="text-center mb-4">
                    <div class="nav nav-pills justify-content-center">
                        <a href="{{ url_for('dashboard_redirect') }}" class="nav-link">
                            <i class="fas fa-home me-2"></i>Dashboard
                        </a>
                        <a href="{{ url_for('scheduler_dashboard') }}" class="nav-link">
                            <i class="fas fa-clock me-2"></i>Schedule
                        </a>
                        <a href="{{ url_for('bullhorn_dashboard') }}" class="nav-link">
                            <i class="fas fa-building me-2"></i>ATS Monitor
                        </a>
                        <a href="{{ url_for('settings') }}" class="nav-link">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                        <a href="{{ url_for('bullhorn_settings') }}" class="nav-link active">
                            <i class="fas fa-key me-2"></i>API Settings
                        </a>
                        <a href="{{ url_for('automation_test') }}" class="nav-link">
                            <i class="fas fa-play me-2"></i>Test
                        </a>
                    </div>
                </div>
                
                <!-- User Info and Logout -->
                <div class="d-flex justify-content-center align-items-center gap-3 mb-4">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-user me-2"></i>
                        <span>Logged in as</span>
                        <span class="badge bg-primary ms-2">{{ current_user.username }}</span>
                    </div>
                    <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">
                        <i class="fas fa-sign-out-alt me-1"></i>
                        Logout
                    </a>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                                <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }} me-2"></i>
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Settings Form -->
                <div class="card settings-card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-key me-2"></i>
                            API Credentials
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="bullhorn_client_id" class="form-label">
                                            <i class="fas fa-id-card me-1"></i>Client ID
                                        </label>
                                        <input type="text" class="form-control" id="bullhorn_client_id" 
                                               name="bullhorn_client_id" value="{{ settings.bullhorn_client_id or '' }}"
                                               placeholder="e.g., abc123de-f456-7890-ab12-cd34ef567890">
                                        <div class="form-text">
                                            OAuth Client ID provided by Bullhorn
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="bullhorn_client_secret" class="form-label">
                                            <i class="fas fa-lock me-1"></i>Client Secret
                                        </label>
                                        <input type="password" class="form-control" id="bullhorn_client_secret" 
                                               name="bullhorn_client_secret" value="{{ settings.bullhorn_client_secret or '' }}"
                                               placeholder="Your OAuth Client Secret">
                                        <div class="form-text">
                                            OAuth Client Secret provided by Bullhorn
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="bullhorn_username" class="form-label">
                                            <i class="fas fa-user me-1"></i>Username
                                        </label>
                                        <input type="text" class="form-control" id="bullhorn_username" 
                                               name="bullhorn_username" value="{{ settings.bullhorn_username or '' }}"
                                               placeholder="Your Bullhorn username">
                                        <div class="form-text">
                                            Your Bullhorn system username
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="bullhorn_password" class="form-label">
                                            <i class="fas fa-key me-1"></i>Password
                                        </label>
                                        <input type="password" class="form-control" id="bullhorn_password" 
                                               name="bullhorn_password" value="{{ settings.bullhorn_password or '' }}"
                                               placeholder="Your Bullhorn password">
                                        <div class="form-text">
                                            Your Bullhorn system password
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" name="action" value="save" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Settings
                                </button>
                                <a href="{{ url_for('bullhorn_oauth_start') }}" class="btn btn-outline-info">
                                    <i class="fas fa-vial me-2"></i>Test Connection
                                </a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Help Section -->
                <div class="card settings-card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-question-circle me-2"></i>
                            Setting Up Bullhorn API Access
                        </h5>
                    </div>
                    <div class="card-body">
                        <h6>1. Contact Bullhorn Support</h6>
                        <p>
                            To get API access, you'll need to contact Bullhorn Support and request OAuth API credentials. 
                            They will provide you with:
                        </p>
                        <ul>
                            <li><strong>Client ID</strong> - OAuth application identifier</li>
                            <li><strong>Client Secret</strong> - OAuth application secret key</li>
                            <li><strong>API Access</strong> - Permission to use REST API endpoints</li>
                        </ul>

                        <h6 class="mt-4">2. Required Redirect URIs</h6>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> Provide both URLs below to Bullhorn Support so you won't need to update them later:
                        </div>
                        
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Current Development URL</h6>
                                <p class="card-text text-muted">For immediate testing and development</p>
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="devRedirectUri" value="{{ request.url_root }}bullhorn/oauth/callback" readonly>
                                    <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('devRedirectUri', this)">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                
                                <h6 class="card-title mt-4">Production URL</h6>
                                <p class="card-text text-muted">Configure your planned production domain</p>
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="prodRedirectUri" 
                                           placeholder="https://your-domain.com/bullhorn/oauth/callback"
                                           value="https://job-feed-refresh.replit.app/bullhorn/oauth/callback">
                                    <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('prodRedirectUri', this)">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                
                                <div class="alert alert-info mb-0">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <strong>Pro Tip:</strong> Copy both URLs and include them in your Bullhorn Support request. 
                                    This way, you can test immediately with the development URL and switch to production later without needing another support ticket.
                                </div>
                            </div>
                        </div>

                        <h6 class="mt-4">3. Required Information</h6>
                        <p>When contacting Bullhorn Support, provide:</p>
                        <ul>
                            <li>Your company name and Bullhorn account details</li>
                            <li>Intended use case (monitoring tearsheet job changes)</li>
                            <li><strong>Both redirect URIs shown above</strong> (development and production)</li>
                            <li>Technical contact information</li>
                            <li>Request OAuth API access with tearsheet monitoring permissions</li>
                        </ul>

                        <h6 class="mt-4">4. Security Notes</h6>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> Your API credentials are stored securely and used only for 
                            accessing your Bullhorn data. Never share these credentials with unauthorized parties.
                        </div>

                        <h6 class="mt-4">5. Support Resources</h6>
                        <ul>
                            <li><a href="https://bullhorn.github.io/rest-api-docs/" target="_blank" class="text-decoration-none" style="color: #ffc107; font-weight: 600;">
                                Bullhorn REST API Documentation <i class="fas fa-external-link-alt"></i>
                            </a></li>
                            <li><a href="https://supportforums.bullhorn.com/" target="_blank" class="text-decoration-none" style="color: #ffc107; font-weight: 600;">
                                Bullhorn Support Forums <i class="fas fa-external-link-alt"></i>
                            </a></li>
                            <li><strong>Bullhorn Support:</strong> Contact through your Bullhorn account portal</li>
                        </ul>
                    </div>
                </div>

                <!-- Terms of Service & OAuth Setup Guide -->
                <div class="card settings-card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                            OAuth Setup & Terms of Service
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>One-Time Setup Required:</strong> The first OAuth authentication requires manual Terms of Service acceptance. This is a Bullhorn security requirement that cannot be automated.
                        </div>

                        <h6>Required First-Time Setup Steps</h6>
                        <ol>
                            <li><strong>Configure API credentials above</strong> (Client ID and Client Secret required for OAuth)</li>
                            <li><strong>Click "Test Connection"</strong> to initiate secure OAuth flow</li>
                            <li><strong>Log in with your Bullhorn credentials</strong> on the Bullhorn login page that opens</li>
                            <li><strong>Accept Terms of Service manually</strong> when prompted by Bullhorn</li>
                            <li><strong>Return to this page</strong> - the OAuth callback will complete authentication automatically</li>
                        </ol>

                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Important Notes:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Terms of Service acceptance is required only <strong>once per credential set</strong></li>
                                <li>After initial acceptance, all future authentications will be automatic</li>
                                <li>If you see redirection issues, this usually means ToS hasn't been accepted yet</li>
                                <li>OAuth authentication will work seamlessly once ToS is accepted</li>
                            </ul>
                        </div>

                        <h6 class="mt-4">What Happens During OAuth Flow</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-success bg-opacity-10 border-success">
                                    <div class="card-body">
                                        <h6 class="card-title text-success">
                                            <i class="fas fa-check-circle me-2"></i>Expected Flow
                                        </h6>
                                        <ol class="small mb-0">
                                            <li>Click "Test Connection"</li>
                                            <li>Bullhorn login page opens</li>
                                            <li>Accept Terms of Service (first time only)</li>
                                            <li>Redirected back with success message</li>
                                            <li>Authentication completed</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-warning bg-opacity-10 border-warning">
                                    <div class="card-body">
                                        <h6 class="card-title text-warning">
                                            <i class="fas fa-exclamation-triangle me-2"></i>Common Issues
                                        </h6>
                                        <ul class="small mb-0">
                                            <li><strong>Redirect loops</strong> → ToS not accepted</li>
                                            <li><strong>"Invalid redirect URI"</strong> → Contact Bullhorn Support</li>
                                            <li><strong>No authorization code</strong> → Clear browser cache and retry</li>
                                            <li><strong>Login page appears repeatedly</strong> → Accept ToS first</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-success mt-3">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Ready to Begin Data Migration:</strong> Once OAuth authentication is successfully completed, your system will be ready to migrate data from PCR to Bullhorn and maintain automated job feed synchronization.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JobPulse™ Footer -->
    <div class="jobpulse-footer">
        © 2025 Lyntrix Solutions
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function copyToClipboard(inputId, button) {
            const input = document.getElementById(inputId);
            input.select();
            document.execCommand('copy');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Copied';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        }
    </script>
</body>
</html>